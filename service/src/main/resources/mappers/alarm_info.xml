<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wangda.alarm.service.dao.AlarmInfoDao">

    <sql id="fields">
        id,
        segment,
        workshop_code AS workshopCode,
        workarea_code AS workAreaCode,
        target_telecode AS targetTeleCode,
        source_telecode AS sourceTeleCode,
        alarm_type AS alarmType,
        alarm_level AS alarmLevel,
        device_type AS deviceType,
        device_no AS deviceNo,
        device_name AS deviceName,
        alarm_time AS alarmTime,
        recover_time AS recoverTime,
        alarm_status AS status,
        alarm_context AS alarmContext,
        overhaul_flag AS overhaulFlag,
        create_time AS createTime,
        remark,
        ext_info AS extInfo
    </sql>

    <insert id="saveAlarmInfo" parameterType="com.wangda.alarm.service.dao.po.AlarmInfoPo">
        INSERT INTO alarm_info(
        segment,
        workshop_code,
        workarea_code,
        target_telecode,
        source_telecode,
        alarm_type,
        alarm_level,
        device_type,
        device_no,
        device_name,
        alarm_time,
        recover_time,
        alarm_status,
        alarm_context,
        overhaul_flag,
        create_time,
        remark,
        ext_info
        ) VALUES (
        #{segment},
        #{workshopCode},
        #{workAreaCode},
        #{targetTeleCode},
        #{sourceTeleCode},
        #{alarmType},
        #{alarmLevel},
        #{deviceType},
        #{deviceNo},
        #{deviceName},
        #{alarmTime},
        #{recoverTime},
        #{status},
        #{alarmContext},
        #{overhaulFlag},
        #{createTime},
        #{remark},
        #{extInfo}
        )
    </insert>

    <insert id="saveAlarmInfos" parameterType="java.util.List">
        INSERT INTO alarm_info(
        segment,
        workshop_code,
        workarea_code,
        target_telecode,
        source_telecode,
        alarm_type,
        alarm_level,
        device_type,
        device_no,
        device_name,
        alarm_time,
        recover_time,
        alarm_status,
        alarm_context,
        overhaul_flag,
        create_time,
        remark,
        ext_info
        ) VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.segment},
            #{item.workshopCode},
            #{item.workAreaCode},
            #{item.targetTeleCode},
            #{item.sourceTeleCode},
            #{item.alarmType},
            #{item.alarmLevel},
            #{item.deviceType},
            #{item.deviceNo},
            #{item.deviceName},
            #{item.alarmTime},
            #{item.recoverTime},
            #{item.status},
            #{item.alarmContext},
            #{item.overhaulFlag},
            #{item.createTime},
            #{item.remark},
            #{item.extInfo}
            )
        </foreach>
    </insert>

    <select id="queryAlarmBySegAndLev" parameterType="java.util.Map" resultType="com.wangda.alarm.service.dao.po.AlarmInfoPo">
        SELECT
        <include refid="fields"/>
        FROM alarm_info
        <where>
            <if test="segment != null">
                AND segment=#{segment}
            </if>
            <if test="level != null">
                AND alarm_level = #{level}
            </if>
        </where>
    </select>

    <select id="queryAlarmByParam" parameterType="com.wangda.alarm.service.dao.req.QueryAlarmListParam"
      resultType="com.wangda.alarm.service.dao.po.AlarmListPo">
        SELECT
        DISTINCT
        source_telecode AS sourceTelecode,
        alarm_level AS alarmLevel,
        alarm_type,
        device_name
        FROM alarm_info
        <where>
            <if test="segmentCode != null and segmentCode !=''">
                AND segment=#{segmentCode}
            </if>
            <if test="workShopCode != null and workShopCode !=''">
                AND workshop_code=#{workShopCode}
            </if>
            <if test="workAreaCode != null and workAreaCode !=''">
                AND workarea_code=#{workAreaCode}
            </if>
            <if test="stationCode != null and stationCode !=''">
                AND source_telecode=#{stationCode}
            </if>
            <if test="level != null">
                AND alarm_level=#{level}
            </if>
            <if test="alarmType != null">
                AND alarm_type=#{alarmType}
            </if>
        </where>
    </select>

    <select id="queryAlarmDetail" parameterType="com.wangda.alarm.service.dao.req.QueryAlarmDetailParam"
        resultType="com.wangda.alarm.service.dao.po.AlarmInfoPo">
        SELECT
        <include refid="fields"/>
        FROM alarm_info
        WHERE segment=#{segmentCode} AND workshop_code=#{workShopCode} AND workarea_code=#{workAreaCode} AND source_telecode=#{stationCode}
        AND alarm_type=#{alarmType} AND alarm_level=#{level} AND device_name=#{deviceName}
    </select>
</mapper>
